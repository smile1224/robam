<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>搜索列表</title>
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="sass/search.css">

</head>

<body>
    <!-- 导航部分 -->
    <div id="header" class="header">
        <!-- 导航头部 -->
        <div class="top">
            <div class="margin">
                <ul class="left">
                    <li><a href="#">老板电器品牌官网</a></li>
                    <li><a href="#">收藏官方商城</a></li>
                    <li><a href="#">购买指南</a></li>
                    <li><a href="#">客服经理微信号</a></li>
                    <li><a href="#">电子发票</a></li>
                </ul>
                <ul class="right">
                    <li><a href="#">签到送积分</a></li>
                    <li><a href="carshop.html"><i><img src="img/car.png" alt=""></i>购物车<span>0</span></a></li>
                    <li><a href="login.html">登录</a></li>
                    <li><a href="register.html">注册</a></li>
                    <li><a href="#">我的订单</a></li>
                </ul>
            </div>
        </div>
        <!-- logo部分 -->
        <div class="bottom">
            <div class="margin">
                <div class="logo">
                    <a href="index.html"><img src="img/logo_40.png" alt=""></a>
                </div>
                <div class="nav">
                    <ul>
                        <li><a href="index.html">首页</a></li>
                        <li class="two" id="quanbus">
                            <a href="#">全部商品</a>
                        </li>
                        <li><a href="#">12.12年终特惠</a></li>
                        <li><a href="#">多件多折</a></li>
                        <li><a href="#">品牌故事</a></li>
                    </ul>
                </div>
                <div class="integral">
                    <ul>
                        <li><a href="#">积分兑换</a><span>|</span></li>
                        <li><a href="#">注册有礼</a></li>
                    </ul>
                    <div class="search">
                        <form action="search.html">
                            <input type="text" placeholder="搜索如：油烟机" class="ser" id="search">
                            <input type="submit" class="sbt" value="" onclick="Submit()">
                            <div id="content"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 产品系列 -->
    <div id="products" class="search-products">
        <div class="margin">
            <!-- 小导航 -->
            <div class="snav margin">
                <a href="index.html">首页</a>
                ><a href="/Products/index">全部商品</a>
                ><a>商品列表</a>
            </div>
            <!-- 条件 -->
            <div class="pro">
                <ul class="list">
                    <li id="li_catid">
                        <span class="title">产品系列 ：</span>
                        <dl class="con">
                            <dd>烟灶套餐</dd>
                            <dd>烟灶消套装</dd>
                            <dd>烟灶热套装</dd>
                            <dd>油烟机</dd>
                            <dd>燃气灶</dd>
                            <dd>消毒柜</dd>
                            <dd>洗碗机/净水机</dd>
                            <dd>蒸箱/烤箱</dd>
                            <dd>多件套</dd>
                            <dd>专柜同款</dd>
                            <dd>周边生活</dd>
                        </dl>
                    </li>
                    <li id="li_range">
                        <span class="title">价格区间 ：</span>
                        <dl class="con">
                            <dd>0-2999</dd>
                            <dd>3000-4999</dd>
                            <dd>5000-5999</dd>
                            <dd>6000-6999</dd>
                            <dd>7000-7999</dd>
                            <dd>8000以上</dd>
                        </dl>
                    </li>
                    <li class="last">
                        <span class="title">已选条件 ：</span>
                        <div class="con" id="selected">
                            <a href="#">
                                油烟机
                                <span class="bb"></span>
                            </a>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="pro-title margin">
                <!-- 销量 价格 评价 -->
                <ul class="sort">
                    <!-- 销量 -->
                    <li>
                        <a href="#">
                            销量
                            <div class="btns">
                                <span class="top"></span>
                                <span class="bottom"></span>
                            </div>
                        </a>
                    </li>
                    <!-- 价格 -->
                    <li>
                        <a href="#">
                            价格
                            <div class="btns">
                                <span class="top"></span>
                                <span class="bottom"></span>
                            </div>
                        </a>
                    </li>
                    <!-- 评价 -->
                    <li>
                        <a href="#">
                            评价
                            <div class="btns">
                                <span class="top"></span>
                                <span class="bottom"></span>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- 商品图 -->
            <div class="cont">
                <ul class="bbox" id="contt">
                </ul>
            </div>

            <!-- 翻页 -->
            <div class="page">

            </div>
        </div>
    </div>
    <!-- 底部 -->
    <div id="footer">
        <div class="margin">
            <dl class="f-t">
                <dd style="width: 212px;">
                    <a href="#">
                        <img src="img/foot01.png" alt="">
                        <p>官方直营</p>
                    </a>
                </dd>
                <dd style="width:168px;">
                    <a href="#">
                        <img src="img/foot01.png" alt="">
                        <p>6000家服务网点</p>
                    </a>
                </dd>
                <dd style="width:217px;">
                    <a href="#">
                        <img src="img/foot01.png" alt="">
                        <p>100%免费配送</p>
                    </a>
                </dd>
                <dd style="width:164px;">
                    <a href="#">
                        <img src="img/foot01.png" alt="">
                        <p>15天无理由退货</p>
                    </a>
                </dd>
                <dd style="width:197px;">
                    <a href="#">
                        <img src="img/foot01.png" alt="">
                        <p>45天无理由换货</p>
                    </a>
                </dd>
                <dd style="width:180px;">
                    <a href="#">
                        <img src="img/foot01.png" alt="">
                        <p>100%品质保证</p>
                    </a>
                </dd>
            </dl>
            <div class="f-c">
                <ul class="f-c-l">
                    <li class="li1">
                        <h2>购物指南</h2>
                        <p>
                            <a target="_blank" href="#">密码相关</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">购物流程</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">交易条款</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">注册登录</a>
                        </p>
                    </li>
                    <li class="li1">
                        <h2>支付方式</h2>
                        <p>
                            <a target="_blank" href="#">网银支付</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">支付宝支付</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">发票说明</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">银联支付</a>
                        </p>
                    </li>
                    <li class="li1">
                        <h2>物流配送</h2>
                        <p>
                            <a target="_blank" href="#">区域安装说明</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">配送方式</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">全场包邮</a>
                        </p>
                    </li>
                    <li class="li1">
                        <h2>售后服务</h2>
                        <p>
                            <a target="_blank" href="#">关于安装</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">售后服务政策</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">退换货说明</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">产品质量保证</a>
                        </p>
                    </li>
                    <li class="li1">
                        <h2>常见问题</h2>
                        <p>
                            <a target="_blank" href="#">积分是什么？</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">积分有什么用？</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">如何获取积分？</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">积分使用规则</a>
                        </p>
                    </li>
                    <li class="li1">
                        <h2>会员须知</h2>
                        <p>
                            <a target="_blank" href="#">邀请好友注册</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">邀请好友送积分</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">安全承诺</a>
                        </p>
                    </li>
                    <li class="li1">
                        <h2>老板合伙人</h2>
                        <p>
                            <a target="_blank" href="#">合伙人政策</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">新手指引</a>
                        </p>
                    </li>
                    <li class="li1">
                        <h2>文章精选</h2>
                        <p>
                            <a target="_blank" href="#">测评-烟机26A7</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">烟机选购</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">净水器选购</a>
                        </p>
                        <p>
                            <a target="_blank" href="#">烤箱选购指南</a>
                        </p>
                    </li>
                </ul>
                <div class="f-c-r">
                    <h2>9510-5855</h2>
                    <p>全 国 统 一 服 务 热 线</p>
                    <a href="#" class="link">
                        <i></i>
                        在线客服
                    </a>
                </div>
            </div>
            <div class="f-b">
                <a href="#" target="_blank">关于老板电器</a>
                <i></i>
                <a href="#" target="_blank">版权说明</a>
                <i></i>
                <a href="#" target="_blank">联系我们</a>
                <i></i>
                <a href="#" target="_blank">友情链接</a>
                <p>Copyright 2018 版权所有 杭州老板电器股份有限公司 浙ICP备05008711号-8</p>
                <a href="#" class="bf" target="_blank">
                    <img src="img/foot10.svg" alt="">
                </a>
                <a href="#" class="bf" target="_blank">
                    <img src="img/foot09.svg" alt="">
                </a>
                <a href="#" class="bf" target="_blank">
                    <img src="img/foot10.svg" alt="">
                </a>
            </div>
        </div>
    </div>
</body>
<!-- 向后台要数据渲染页面 -->
<script src="js/ajax.js"></script>
<script src="js/cookie.js"></script>
<script type="text/javascript">
    // 一 渲染页面
    class Page {
        constructor() {
            this.url = "http://localhost/robam/data/goods.json";
            // 数据拿来放到conta里面
            this.conta = document.getElementById("contt");
            // 请求数据
            this.load()
            // 绑定添加购物车事件，初始没有em利用事件委托
            this.addEvent();
        }
        load() {
            // 开启ajax
            var that = this;
            ajaxGet(this.url, function (res) {
                // 数据是否拿到,以及数据的格式
                // console.log(res);
                // 解析成对象
                that.res = JSON.parse(res)
                // console.log(that.res);
                // 渲染页面
                that.display();
            })
        }

        display() {
            // 拿到数据说明可以去解析填充数据了
            // console.log(this.res);
            var str = "";
            for (var i = 0; i < this.res.length; i++) {
                // ES6拼接
                // 自定义属性index = goodsId
                str += `<li class="box" index="${this.res[i].goodsId}">
                                <div class="bt">
                                    <span class="red">立减200元</span>
                                </div>
                                <div class="imgbox">
                                    <img src="${this.res[i].img}" />
                                </div>
                                <div class="name">
                                    <a href="Detailspage.html">
                                        <h2>${this.res[i].name}</h2>
                                    </a>
                                    <p>
                                        <a href="Detailspage.html">${this.res[i].active}</a>
                                    </p>
                                </div>
                                <div class="price">
                                    ￥
                                    <span class="money">${this.res[i].price}</span>
                                    <em class="addCar">加入购物车</em>
                                    <p>${this.res[i].pay}</p>
                                </div>
                            </li>`
            }
            this.conta.innerHTML = str;
        }
        addEvent() {
            var that = this;
            // 二 点击进入，事件委托
            this.conta.addEventListener("click", function (eve) {
                var e = eve || window.event;
                // 点击找事件源
                var target = e.target || e.srcElement;
                if (target.className == "addCar") {
                    // 1.点击时找到当前点击商品的货号；找到按钮后存商品id的自定义属性
                    that.id = target.parentNode.parentNode.getAttribute("index");
                    // 点谁获取谁的id
                    // console.log(that.id);
                    //  2.准备存cookie
                    that.setCookie();
                }
            })
        }
        setCookie() {
            // 无值给空数组，有值直接解析了
            this.goods = getCookie("goodsDECookie") ? JSON.parse(getCookie("goodsDECookie")) : [];
            // console.log(this.goods);
            // 3.存之前，判断是第一次还是非第一次
            if (this.goods.length < 1) { //长度小于1，说明肯定是第一次存。
                // 直接加入往数组里面填充数据
                this.goods.push({
                    id: this.id,//id就是你点击的那一个商品的goodsId;
                    num: 1//num为1
                })
            } else {//虽然页面不是第一次点击，但是可能这个商品是第一次点击，所以依然进行判断
                var i = 0;
                var onoff = this.goods.some((val, idx) => {
                    i = idx;
                    return val.id === this.id;
                })
                //新商品,增加
                if (!onoff) { //这个商品是第一次点击，与第一次点击商品操作相同
                    this.goods.push({
                        id: this.id,//这个this.id在构造函数时获取到的；
                        num: 1
                    })
                } else {
                    this.goods[i].num++;
                }
            }
            // 4.经过第三步对数据的处理，可以将数据再设置回cookie了
            // 再塞回去
            setCookie("goodsDECookie", JSON.stringify(this.goods))//if执行完之后执行这个；
            // console.log(this.goods)
            // console.log(JSON.stringify(this.goods))
        }

    }
    new Page;
</script>
<!-- Ajax搜索，需要前后端配合，将关键字发送一个请求到后端，后端需要将结果的数据传给前端，前端根据返回的数据，重新对页面部分进行渲染 -->
<script>
    class Search {
        constructor() {
            this.url = "http://localhost/robam/data/goods.json";
            // 数据拿来放到conta里面
            this.sea = document.getElementById("search");
            this.ocontent = document.getElementById("content");
            // 请求数据
            this.load()
        }
        load() {
            // 开启ajax
            var that = this;
            ajaxGet(this.url, function (res) {
                // 数据是否拿到,以及数据的格式
                // console.log(res);
                // 解析成对象
                that.res = JSON.parse(res)
                // console.log(that.res);
                // 渲染页面
                that.SearchNotes();
            })
        }
        SearchNotes() {
            // 拿到数据说明可以去解析填充数据了
            // console.log(this.res);
            var str = ""
            for (var i = 0; i < this.res.length; i++) {
                // ES6拼接
                // 自定义属性index = goodsId
                str += `${this.res[i].name}<br>`
            }
            this.ocontent.innerHTML = str;
        }
    }
    new Search;


</script>

</html>